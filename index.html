<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Steam Backlog</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #121212;
      color: #e0e0e0;
    }
    .table img {
      width: 60px;
      height: auto;
      border-radius: 6px;
    }
    .form-control, .form-select {
      background-color: #1e1e1e;
      color: #e0e0e0;
      border: 1px solid #444;
    }
    .form-control:focus, .form-select:focus {
      border-color: #888;
      box-shadow: none;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <h1 class="mb-4">ðŸŽ® Steam Backlog</h1>

    <div class="row mb-4">
      <div class="col-md-6">
        <input type="text" id="searchInput" class="form-control" placeholder="Search games..." />
      </div>
      <div class="col-md-3">
        <select id="statusFilter" class="form-select">
          <option value="">All Statuses</option>
        </select>
      </div>
      <div class="col-md-3">
        <select id="genreFilter" class="form-select">
          <option value="">All Genres</option>
        </select>
      </div>
    </div>

    <table class="table table-dark table-striped">
      <thead>
        <tr>
          <th>Game</th>
          <th>Status</th>
          <th>HLTB (hrs)</th>
          <th>Played (hrs)</th>
          <th>Genres</th>
        </tr>
      </thead>
      <tbody id="gameTable">
        <!-- Rows injected by JS -->
      </tbody>
    </table>
  </div>

  <script>
    const games = [];

    const genreTranslation = {
      "Abenteuer": "Adventure",
      "Strategie": "Strategy",
      "Action": "Action",
      "RPG": "RPG",
      "Indie": "Indie",
      "Simulation": "Simulation",
      "Sport": "Sports",
      "Mehrspieler": "Multiplayer"
      // Add more as needed
    };

    fetch("Steam%20Backlog%20-%20Display%20View.csv")
      .then(response => response.text())
      .then(data => {
        const rows = data.trim().split("\n");
        const headers = rows.shift().split(",");

        rows.forEach(row => {
          const values = row.split(",");
          const [title, status, hltb, played, cover, genres] = values;
          games.push({ title, status, hltb, played, cover, genres });
        });

        populateGenres();
        populateStatuses();
        renderTable();
      });

    function renderTable() {
      const search = document.getElementById("searchInput").value.toLowerCase();
      const status = document.getElementById("statusFilter").value;
      const genre = document.getElementById("genreFilter").value;

      const tbody = document.getElementById("gameTable");
      tbody.innerHTML = "";

      games.forEach(game => {
        const translatedGenres = game.genres.split(";").map(g => genreTranslation[g.trim()] || g.trim()).join(", ");

        if (
          (search && !game.title.toLowerCase().includes(search)) ||
          (status && game.status !== status) ||
          (genre && !translatedGenres.includes(genre))
        ) return;

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>
            <div class="d-flex align-items-center gap-2">
              <img src="${game.cover}" alt="cover" onerror="this.src='default.jpg'" />
              <span>${game.title}</span>
            </div>
          </td>
          <td>${game.status}</td>
          <td>${parseFloat(game.hltb || 0).toFixed(0)}</td>
          <td>${parseFloat(game.played || 0).toFixed(0)}</td>
          <td>${translatedGenres}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function populateGenres() {
      const genreSet = new Set();
      games.forEach(g => {
        g.genres.split(";").forEach(gen => {
          const trimmed = gen.trim();
          const translated = genreTranslation[trimmed] || trimmed;
          genreSet.add(translated);
        });
      });

      const genreFilter = document.getElementById("genreFilter");
      [...genreSet].sort().forEach(genre => {
        const option = document.createElement("option");
        option.value = genre;
        option.textContent = genre;
        genreFilter.appendChild(option);
      });
    }

    function populateStatuses() {
      const statusSet = new Set(games.map(g => g.status));
      const statusFilter = document.getElementById("statusFilter");
      [...statusSet].sort().forEach(status => {
        const option = document.createElement("option");
        option.value = status;
        option.textContent = status;
        statusFilter.appendChild(option);
      });
    }

    document.getElementById("searchInput").addEventListener("input", renderTable);
    document.getElementById("statusFilter").addEventListener("change", renderTable);
    document.getElementById("genreFilter").addEventListener("change", renderTable);
  </script>
</body>
</html>
